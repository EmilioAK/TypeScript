<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - lcov.info - jsTyping/jsTyping.ts</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../index.html" title="Click to go to top-level">top level</a> - <a href="index.html" title="Click to go to directory jsTyping">jsTyping</a> - jsTyping.ts<span style="font-size: 80%;"> (source / <a href="jsTyping.ts.func-c.html" title="Click to go to function table">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">lcov.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryHi">97.7&nbsp;%</td>
            <td class="headerCovTableEntry">596</td>
            <td class="headerCovTableEntry">582</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2024-06-27 21:34:48</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryHi">100.0&nbsp;%</td>
            <td class="headerCovTableEntry">14</td>
            <td class="headerCovTableEntry">14</td>
          </tr>
                  <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">            Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span> <span class="tlaGNC tlaBgGNC">           8 : import {</span></span>
<span id="L2"><span class="lineNum">       2</span> <span class="tlaGNC">           8 :   CharacterCodes,</span></span>
<span id="L3"><span class="lineNum">       3</span> <span class="tlaGNC">           8 :   combinePaths,</span></span>
<span id="L4"><span class="lineNum">       4</span> <span class="tlaGNC">           8 :   compareStringsCaseSensitive,</span></span>
<span id="L5"><span class="lineNum">       5</span> <span class="tlaGNC">           8 :   CompilerOptions,</span></span>
<span id="L6"><span class="lineNum">       6</span> <span class="tlaGNC">           8 :   Debug,</span></span>
<span id="L7"><span class="lineNum">       7</span> <span class="tlaGNC">           8 :   deduplicate,</span></span>
<span id="L8"><span class="lineNum">       8</span> <span class="tlaGNC">           8 :   equateStringsCaseSensitive,</span></span>
<span id="L9"><span class="lineNum">       9</span> <span class="tlaGNC">           8 :   Extension,</span></span>
<span id="L10"><span class="lineNum">      10</span> <span class="tlaGNC">           8 :   fileExtensionIs,</span></span>
<span id="L11"><span class="lineNum">      11</span> <span class="tlaGNC">           8 :   flatMap,</span></span>
<span id="L12"><span class="lineNum">      12</span> <span class="tlaGNC">           8 :   forEach,</span></span>
<span id="L13"><span class="lineNum">      13</span> <span class="tlaGNC">           8 :   getBaseFileName,</span></span>
<span id="L14"><span class="lineNum">      14</span> <span class="tlaGNC">           8 :   getDirectoryPath,</span></span>
<span id="L15"><span class="lineNum">      15</span> <span class="tlaGNC">           8 :   getNormalizedAbsolutePath,</span></span>
<span id="L16"><span class="lineNum">      16</span> <span class="tlaGNC">           8 :   getOwnKeys,</span></span>
<span id="L17"><span class="lineNum">      17</span> <span class="tlaGNC">           8 :   getPathComponents,</span></span>
<span id="L18"><span class="lineNum">      18</span> <span class="tlaGNC">           8 :   getProperty,</span></span>
<span id="L19"><span class="lineNum">      19</span> <span class="tlaGNC">           8 :   hasJSFileExtension,</span></span>
<span id="L20"><span class="lineNum">      20</span> <span class="tlaGNC">           8 :   mapDefined,</span></span>
<span id="L21"><span class="lineNum">      21</span> <span class="tlaGNC">           8 :   MapLike,</span></span>
<span id="L22"><span class="lineNum">      22</span> <span class="tlaGNC">           8 :   normalizePath,</span></span>
<span id="L23"><span class="lineNum">      23</span> <span class="tlaGNC">           8 :   Path,</span></span>
<span id="L24"><span class="lineNum">      24</span> <span class="tlaGNC">           8 :   readConfigFile,</span></span>
<span id="L25"><span class="lineNum">      25</span> <span class="tlaGNC">           8 :   removeFileExtension,</span></span>
<span id="L26"><span class="lineNum">      26</span> <span class="tlaGNC">           8 :   removeMinAndVersionNumbers,</span></span>
<span id="L27"><span class="lineNum">      27</span> <span class="tlaGNC">           8 :   some,</span></span>
<span id="L28"><span class="lineNum">      28</span> <span class="tlaGNC">           8 :   toFileNameLowerCase,</span></span>
<span id="L29"><span class="lineNum">      29</span> <span class="tlaGNC">           8 :   TypeAcquisition,</span></span>
<span id="L30"><span class="lineNum">      30</span> <span class="tlaGNC">           8 :   Version,</span></span>
<span id="L31"><span class="lineNum">      31</span> <span class="tlaGNC">           8 :   versionMajorMinor,</span></span>
<span id="L32"><span class="lineNum">      32</span> <span class="tlaGNC">           8 : } from &quot;./_namespaces/ts.js&quot;;</span></span>
<span id="L33"><span class="lineNum">      33</span> <span class="tlaGNC">           8 : import { stringifyIndented } from &quot;./_namespaces/ts.server.js&quot;;</span></span>
<span id="L34"><span class="lineNum">      34</span> <span class="tlaGNC">           8 : </span></span>
<span id="L35"><span class="lineNum">      35</span> <span class="tlaGNC">           8 : export interface TypingResolutionHost {</span></span>
<span id="L36"><span class="lineNum">      36</span> <span class="tlaGNC">           8 :   directoryExists(path: string): boolean;</span></span>
<span id="L37"><span class="lineNum">      37</span> <span class="tlaGNC">           8 :   fileExists(fileName: string): boolean;</span></span>
<span id="L38"><span class="lineNum">      38</span> <span class="tlaGNC">           8 :   readFile(path: string, encoding?: string): string | undefined;</span></span>
<span id="L39"><span class="lineNum">      39</span> <span class="tlaGNC">           8 :   readDirectory(</span></span>
<span id="L40"><span class="lineNum">      40</span> <span class="tlaGNC">           8 :     rootDir: string,</span></span>
<span id="L41"><span class="lineNum">      41</span> <span class="tlaGNC">           8 :     extensions: readonly string[],</span></span>
<span id="L42"><span class="lineNum">      42</span> <span class="tlaGNC">           8 :     excludes: readonly string[] | undefined,</span></span>
<span id="L43"><span class="lineNum">      43</span> <span class="tlaGNC">           8 :     includes: readonly string[] | undefined,</span></span>
<span id="L44"><span class="lineNum">      44</span> <span class="tlaGNC">           8 :     depth?: number,</span></span>
<span id="L45"><span class="lineNum">      45</span> <span class="tlaGNC">           8 :   ): string[];</span></span>
<span id="L46"><span class="lineNum">      46</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L47"><span class="lineNum">      47</span> <span class="tlaGNC">           8 : </span></span>
<span id="L48"><span class="lineNum">      48</span> <span class="tlaGNC">           8 : interface PackageJson {</span></span>
<span id="L49"><span class="lineNum">      49</span> <span class="tlaGNC">           8 :   dependencies?: MapLike&lt;string&gt;;</span></span>
<span id="L50"><span class="lineNum">      50</span> <span class="tlaGNC">           8 :   devDependencies?: MapLike&lt;string&gt;;</span></span>
<span id="L51"><span class="lineNum">      51</span> <span class="tlaGNC">           8 :   name?: string;</span></span>
<span id="L52"><span class="lineNum">      52</span> <span class="tlaGNC">           8 :   optionalDependencies?: MapLike&lt;string&gt;;</span></span>
<span id="L53"><span class="lineNum">      53</span> <span class="tlaGNC">           8 :   peerDependencies?: MapLike&lt;string&gt;;</span></span>
<span id="L54"><span class="lineNum">      54</span> <span class="tlaGNC">           8 :   types?: string;</span></span>
<span id="L55"><span class="lineNum">      55</span> <span class="tlaGNC">           8 :   typings?: string;</span></span>
<span id="L56"><span class="lineNum">      56</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L57"><span class="lineNum">      57</span> <span class="tlaGNC">           8 : </span></span>
<span id="L58"><span class="lineNum">      58</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L59"><span class="lineNum">      59</span> <span class="tlaGNC">           8 : export interface CachedTyping {</span></span>
<span id="L60"><span class="lineNum">      60</span> <span class="tlaGNC">           8 :   typingLocation: string;</span></span>
<span id="L61"><span class="lineNum">      61</span> <span class="tlaGNC">           8 :   version: Version;</span></span>
<span id="L62"><span class="lineNum">      62</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L63"><span class="lineNum">      63</span> <span class="tlaGNC">           8 : </span></span>
<span id="L64"><span class="lineNum">      64</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L65"><span class="lineNum">      65</span> <span class="tlaGNC">           8 : export function isTypingUpToDate(</span></span>
<span id="L66"><span class="lineNum">      66</span> <span class="tlaGNC">           8 :   cachedTyping: CachedTyping,</span></span>
<span id="L67"><span class="lineNum">      67</span> <span class="tlaGNC">           8 :   availableTypingVersions: MapLike&lt;string&gt;,</span></span>
<span id="L68"><span class="lineNum">      68</span> <span class="tlaGNC">           8 : ) {</span></span>
<span id="L69"><span class="lineNum">      69</span> <span class="tlaGNC">           8 :   const availableVersion = new Version(</span></span>
<span id="L70"><span class="lineNum">      70</span> <span class="tlaGNC">           8 :     getProperty(availableTypingVersions, `ts${versionMajorMinor}`) ||</span></span>
<span id="L71"><span class="lineNum">      71</span> <span class="tlaGNC">           8 :       getProperty(availableTypingVersions, &quot;latest&quot;)!,</span></span>
<span id="L72"><span class="lineNum">      72</span> <span class="tlaGNC">           8 :   );</span></span>
<span id="L73"><span class="lineNum">      73</span> <span class="tlaGNC">           8 :   return availableVersion.compareTo(cachedTyping.version) &lt;= 0;</span></span>
<span id="L74"><span class="lineNum">      74</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L75"><span class="lineNum">      75</span> <span class="tlaGNC">           8 : </span></span>
<span id="L76"><span class="lineNum">      76</span> <span class="tlaGNC">           8 : const unprefixedNodeCoreModuleList = [</span></span>
<span id="L77"><span class="lineNum">      77</span> <span class="tlaGNC">           8 :   &quot;assert&quot;,</span></span>
<span id="L78"><span class="lineNum">      78</span> <span class="tlaGNC">           8 :   &quot;assert/strict&quot;,</span></span>
<span id="L79"><span class="lineNum">      79</span> <span class="tlaGNC">           8 :   &quot;async_hooks&quot;,</span></span>
<span id="L80"><span class="lineNum">      80</span> <span class="tlaGNC">           8 :   &quot;buffer&quot;,</span></span>
<span id="L81"><span class="lineNum">      81</span> <span class="tlaGNC">           8 :   &quot;child_process&quot;,</span></span>
<span id="L82"><span class="lineNum">      82</span> <span class="tlaGNC">           8 :   &quot;cluster&quot;,</span></span>
<span id="L83"><span class="lineNum">      83</span> <span class="tlaGNC">           8 :   &quot;console&quot;,</span></span>
<span id="L84"><span class="lineNum">      84</span> <span class="tlaGNC">           8 :   &quot;constants&quot;,</span></span>
<span id="L85"><span class="lineNum">      85</span> <span class="tlaGNC">           8 :   &quot;crypto&quot;,</span></span>
<span id="L86"><span class="lineNum">      86</span> <span class="tlaGNC">           8 :   &quot;dgram&quot;,</span></span>
<span id="L87"><span class="lineNum">      87</span> <span class="tlaGNC">           8 :   &quot;diagnostics_channel&quot;,</span></span>
<span id="L88"><span class="lineNum">      88</span> <span class="tlaGNC">           8 :   &quot;dns&quot;,</span></span>
<span id="L89"><span class="lineNum">      89</span> <span class="tlaGNC">           8 :   &quot;dns/promises&quot;,</span></span>
<span id="L90"><span class="lineNum">      90</span> <span class="tlaGNC">           8 :   &quot;domain&quot;,</span></span>
<span id="L91"><span class="lineNum">      91</span> <span class="tlaGNC">           8 :   &quot;events&quot;,</span></span>
<span id="L92"><span class="lineNum">      92</span> <span class="tlaGNC">           8 :   &quot;fs&quot;,</span></span>
<span id="L93"><span class="lineNum">      93</span> <span class="tlaGNC">           8 :   &quot;fs/promises&quot;,</span></span>
<span id="L94"><span class="lineNum">      94</span> <span class="tlaGNC">           8 :   &quot;http&quot;,</span></span>
<span id="L95"><span class="lineNum">      95</span> <span class="tlaGNC">           8 :   &quot;https&quot;,</span></span>
<span id="L96"><span class="lineNum">      96</span> <span class="tlaGNC">           8 :   &quot;http2&quot;,</span></span>
<span id="L97"><span class="lineNum">      97</span> <span class="tlaGNC">           8 :   &quot;inspector&quot;,</span></span>
<span id="L98"><span class="lineNum">      98</span> <span class="tlaGNC">           8 :   &quot;module&quot;,</span></span>
<span id="L99"><span class="lineNum">      99</span> <span class="tlaGNC">           8 :   &quot;net&quot;,</span></span>
<span id="L100"><span class="lineNum">     100</span> <span class="tlaGNC">           8 :   &quot;os&quot;,</span></span>
<span id="L101"><span class="lineNum">     101</span> <span class="tlaGNC">           8 :   &quot;path&quot;,</span></span>
<span id="L102"><span class="lineNum">     102</span> <span class="tlaGNC">           8 :   &quot;perf_hooks&quot;,</span></span>
<span id="L103"><span class="lineNum">     103</span> <span class="tlaGNC">           8 :   &quot;process&quot;,</span></span>
<span id="L104"><span class="lineNum">     104</span> <span class="tlaGNC">           8 :   &quot;punycode&quot;,</span></span>
<span id="L105"><span class="lineNum">     105</span> <span class="tlaGNC">           8 :   &quot;querystring&quot;,</span></span>
<span id="L106"><span class="lineNum">     106</span> <span class="tlaGNC">           8 :   &quot;readline&quot;,</span></span>
<span id="L107"><span class="lineNum">     107</span> <span class="tlaGNC">           8 :   &quot;repl&quot;,</span></span>
<span id="L108"><span class="lineNum">     108</span> <span class="tlaGNC">           8 :   &quot;stream&quot;,</span></span>
<span id="L109"><span class="lineNum">     109</span> <span class="tlaGNC">           8 :   &quot;stream/promises&quot;,</span></span>
<span id="L110"><span class="lineNum">     110</span> <span class="tlaGNC">           8 :   &quot;string_decoder&quot;,</span></span>
<span id="L111"><span class="lineNum">     111</span> <span class="tlaGNC">           8 :   &quot;timers&quot;,</span></span>
<span id="L112"><span class="lineNum">     112</span> <span class="tlaGNC">           8 :   &quot;timers/promises&quot;,</span></span>
<span id="L113"><span class="lineNum">     113</span> <span class="tlaGNC">           8 :   &quot;tls&quot;,</span></span>
<span id="L114"><span class="lineNum">     114</span> <span class="tlaGNC">           8 :   &quot;trace_events&quot;,</span></span>
<span id="L115"><span class="lineNum">     115</span> <span class="tlaGNC">           8 :   &quot;tty&quot;,</span></span>
<span id="L116"><span class="lineNum">     116</span> <span class="tlaGNC">           8 :   &quot;url&quot;,</span></span>
<span id="L117"><span class="lineNum">     117</span> <span class="tlaGNC">           8 :   &quot;util&quot;,</span></span>
<span id="L118"><span class="lineNum">     118</span> <span class="tlaGNC">           8 :   &quot;util/types&quot;,</span></span>
<span id="L119"><span class="lineNum">     119</span> <span class="tlaGNC">           8 :   &quot;v8&quot;,</span></span>
<span id="L120"><span class="lineNum">     120</span> <span class="tlaGNC">           8 :   &quot;vm&quot;,</span></span>
<span id="L121"><span class="lineNum">     121</span> <span class="tlaGNC">           8 :   &quot;wasi&quot;,</span></span>
<span id="L122"><span class="lineNum">     122</span> <span class="tlaGNC">           8 :   &quot;worker_threads&quot;,</span></span>
<span id="L123"><span class="lineNum">     123</span> <span class="tlaGNC">           8 :   &quot;zlib&quot;,</span></span>
<span id="L124"><span class="lineNum">     124</span> <span class="tlaGNC">           8 : ];</span></span>
<span id="L125"><span class="lineNum">     125</span> <span class="tlaGNC">           8 : </span></span>
<span id="L126"><span class="lineNum">     126</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L127"><span class="lineNum">     127</span> <span class="tlaGNC">           8 : export const prefixedNodeCoreModuleList = unprefixedNodeCoreModuleList.map(</span></span>
<span id="L128"><span class="lineNum">     128</span> <span class="tlaGNC">           8 :   (name) =&gt; `node:${name}`,</span></span>
<span id="L129"><span class="lineNum">     129</span> <span class="tlaGNC">           8 : );</span></span>
<span id="L130"><span class="lineNum">     130</span> <span class="tlaGNC">           8 : </span></span>
<span id="L131"><span class="lineNum">     131</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L132"><span class="lineNum">     132</span> <span class="tlaGNC">           8 : export const nodeCoreModuleList: readonly string[] = [</span></span>
<span id="L133"><span class="lineNum">     133</span> <span class="tlaGNC">           8 :   ...unprefixedNodeCoreModuleList,</span></span>
<span id="L134"><span class="lineNum">     134</span> <span class="tlaGNC">           8 :   ...prefixedNodeCoreModuleList,</span></span>
<span id="L135"><span class="lineNum">     135</span> <span class="tlaGNC">           8 : ];</span></span>
<span id="L136"><span class="lineNum">     136</span> <span class="tlaGNC">           8 : </span></span>
<span id="L137"><span class="lineNum">     137</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L138"><span class="lineNum">     138</span> <span class="tlaGNC">           8 : export const nodeCoreModules = new Set(nodeCoreModuleList);</span></span>
<span id="L139"><span class="lineNum">     139</span> <span class="tlaGNC">           8 : </span></span>
<span id="L140"><span class="lineNum">     140</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L141"><span class="lineNum">     141</span> <span class="tlaGNC">           8 : export function nonRelativeModuleNameForTypingCache(moduleName: string) {</span></span>
<span id="L142"><span class="lineNum">     142</span> <span class="tlaGNC">           8 :   return nodeCoreModules.has(moduleName) ? &quot;node&quot; : moduleName;</span></span>
<span id="L143"><span class="lineNum">     143</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L144"><span class="lineNum">     144</span> <span class="tlaGNC">           8 : </span></span>
<span id="L145"><span class="lineNum">     145</span> <span class="tlaGNC">           8 : /**</span></span>
<span id="L146"><span class="lineNum">     146</span> <span class="tlaGNC">           8 :  * A map of loose file names to library names that we are confident require typings</span></span>
<span id="L147"><span class="lineNum">     147</span> <span class="tlaGNC">           8 :  *</span></span>
<span id="L148"><span class="lineNum">     148</span> <span class="tlaGNC">           8 :  * @internal</span></span>
<span id="L149"><span class="lineNum">     149</span> <span class="tlaGNC">           8 :  */</span></span>
<span id="L150"><span class="lineNum">     150</span> <span class="tlaGNC">           8 : export type SafeList = ReadonlyMap&lt;string, string&gt;;</span></span>
<span id="L151"><span class="lineNum">     151</span> <span class="tlaGNC">           8 : </span></span>
<span id="L152"><span class="lineNum">     152</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L153"><span class="lineNum">     153</span> <span class="tlaGNC">           8 : export function loadSafeList(</span></span>
<span id="L154"><span class="lineNum">     154</span> <span class="tlaGNC">           8 :   host: TypingResolutionHost,</span></span>
<span id="L155"><span class="lineNum">     155</span> <span class="tlaGNC">           8 :   safeListPath: Path,</span></span>
<span id="L156"><span class="lineNum">     156</span> <span class="tlaGNC">           8 : ): SafeList {</span></span>
<span id="L157"><span class="lineNum">     157</span> <span class="tlaGNC">           8 :   const result = readConfigFile(safeListPath, (path) =&gt; host.readFile(path));</span></span>
<span id="L158"><span class="lineNum">     158</span> <span class="tlaGNC">           8 :   return new Map(Object.entries&lt;string&gt;(result.config));</span></span>
<span id="L159"><span class="lineNum">     159</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L160"><span class="lineNum">     160</span> <span class="tlaGNC">           8 : </span></span>
<span id="L161"><span class="lineNum">     161</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L162"><span class="lineNum">     162</span> <span class="tlaGNC">           8 : export function loadTypesMap(</span></span>
<span id="L163"><span class="lineNum">     163</span> <span class="tlaGNC">           8 :   host: TypingResolutionHost,</span></span>
<span id="L164"><span class="lineNum">     164</span> <span class="tlaGNC">           8 :   typesMapPath: Path,</span></span>
<span id="L165"><span class="lineNum">     165</span> <span class="tlaGNC">           8 : ): SafeList | undefined {</span></span>
<span id="L166"><span class="lineNum">     166</span> <span class="tlaGNC">           8 :   const result = readConfigFile(typesMapPath, (path) =&gt; host.readFile(path));</span></span>
<span id="L167"><span class="lineNum">     167</span> <span class="tlaGNC">           8 :   if (result.config?.simpleMap) {</span></span>
<span id="L168"><span class="lineNum">     168</span> <span class="tlaGNC">           8 :     return new Map(Object.entries&lt;string&gt;(result.config.simpleMap));</span></span>
<span id="L169"><span class="lineNum">     169</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L170"><span class="lineNum">     170</span> <span class="tlaGNC">           8 :   return undefined;</span></span>
<span id="L171"><span class="lineNum">     171</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L172"><span class="lineNum">     172</span> <span class="tlaGNC">           8 : </span></span>
<span id="L173"><span class="lineNum">     173</span> <span class="tlaGNC">           8 : /**</span></span>
<span id="L174"><span class="lineNum">     174</span> <span class="tlaGNC">           8 :  * @param host is the object providing I/O related operations.</span></span>
<span id="L175"><span class="lineNum">     175</span> <span class="tlaGNC">           8 :  * @param fileNames are the file names that belong to the same project</span></span>
<span id="L176"><span class="lineNum">     176</span> <span class="tlaGNC">           8 :  * @param projectRootPath is the path to the project root directory</span></span>
<span id="L177"><span class="lineNum">     177</span> <span class="tlaGNC">           8 :  * @param safeListPath is the path used to retrieve the safe list</span></span>
<span id="L178"><span class="lineNum">     178</span> <span class="tlaGNC">           8 :  * @param packageNameToTypingLocation is the map of package names to their cached typing locations and installed versions</span></span>
<span id="L179"><span class="lineNum">     179</span> <span class="tlaGNC">           8 :  * @param typeAcquisition is used to customize the typing acquisition process</span></span>
<span id="L180"><span class="lineNum">     180</span> <span class="tlaGNC">           8 :  * @param compilerOptions are used as a source for typing inference</span></span>
<span id="L181"><span class="lineNum">     181</span> <span class="tlaGNC">           8 :  *</span></span>
<span id="L182"><span class="lineNum">     182</span> <span class="tlaGNC">           8 :  * @internal</span></span>
<span id="L183"><span class="lineNum">     183</span> <span class="tlaGNC">           8 :  */</span></span>
<span id="L184"><span class="lineNum">     184</span> <span class="tlaGNC">           8 : export function discoverTypings(</span></span>
<span id="L185"><span class="lineNum">     185</span> <span class="tlaGNC">           8 :   host: TypingResolutionHost,</span></span>
<span id="L186"><span class="lineNum">     186</span> <span class="tlaGNC">           8 :   log: ((message: string) =&gt; void) | undefined,</span></span>
<span id="L187"><span class="lineNum">     187</span> <span class="tlaGNC">           8 :   fileNames: string[],</span></span>
<span id="L188"><span class="lineNum">     188</span> <span class="tlaGNC">           8 :   projectRootPath: Path,</span></span>
<span id="L189"><span class="lineNum">     189</span> <span class="tlaGNC">           8 :   safeList: SafeList,</span></span>
<span id="L190"><span class="lineNum">     190</span> <span class="tlaGNC">           8 :   packageNameToTypingLocation: ReadonlyMap&lt;string, CachedTyping&gt;,</span></span>
<span id="L191"><span class="lineNum">     191</span> <span class="tlaGNC">           8 :   typeAcquisition: TypeAcquisition,</span></span>
<span id="L192"><span class="lineNum">     192</span> <span class="tlaGNC">           8 :   unresolvedImports: readonly string[],</span></span>
<span id="L193"><span class="lineNum">     193</span> <span class="tlaGNC">           8 :   typesRegistry: ReadonlyMap&lt;string, MapLike&lt;string&gt;&gt;,</span></span>
<span id="L194"><span class="lineNum">     194</span> <span class="tlaGNC">           8 :   compilerOptions: CompilerOptions,</span></span>
<span id="L195"><span class="lineNum">     195</span> <span class="tlaGNC">           8 : ): {</span></span>
<span id="L196"><span class="lineNum">     196</span> <span class="tlaGNC">           8 :   cachedTypingPaths: string[];</span></span>
<span id="L197"><span class="lineNum">     197</span> <span class="tlaGNC">           8 :   newTypingNames: string[];</span></span>
<span id="L198"><span class="lineNum">     198</span> <span class="tlaGNC">           8 :   filesToWatch: string[];</span></span>
<span id="L199"><span class="lineNum">     199</span> <span class="tlaGNC">           8 : } {</span></span>
<span id="L200"><span class="lineNum">     200</span> <span class="tlaGNC">           8 :   if (!typeAcquisition || !typeAcquisition.enable) {</span></span>
<span id="L201"><span class="lineNum">     201</span> <span class="tlaGNC">           8 :     return { cachedTypingPaths: [], newTypingNames: [], filesToWatch: [] };</span></span>
<span id="L202"><span class="lineNum">     202</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L203"><span class="lineNum">     203</span> <span class="tlaGNC">           8 : </span></span>
<span id="L204"><span class="lineNum">     204</span> <span class="tlaGNC">           8 :   // A typing name to typing file path mapping</span></span>
<span id="L205"><span class="lineNum">     205</span> <span class="tlaGNC">           8 :   const inferredTypings = new Map&lt;string, string | false&gt;();</span></span>
<span id="L206"><span class="lineNum">     206</span> <span class="tlaGNC">           8 : </span></span>
<span id="L207"><span class="lineNum">     207</span> <span class="tlaGNC">           8 :   // Only infer typings for .js and .jsx files</span></span>
<span id="L208"><span class="lineNum">     208</span> <span class="tlaGNC">           8 :   fileNames = mapDefined(fileNames, (fileName) =&gt; {</span></span>
<span id="L209"><span class="lineNum">     209</span> <span class="tlaGNC">           8 :     const path = normalizePath(fileName);</span></span>
<span id="L210"><span class="lineNum">     210</span> <span class="tlaGNC">           8 :     if (hasJSFileExtension(path)) {</span></span>
<span id="L211"><span class="lineNum">     211</span> <span class="tlaGNC">           8 :       return path;</span></span>
<span id="L212"><span class="lineNum">     212</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L213"><span class="lineNum">     213</span> <span class="tlaGNC">           8 :   });</span></span>
<span id="L214"><span class="lineNum">     214</span> <span class="tlaGNC">           8 : </span></span>
<span id="L215"><span class="lineNum">     215</span> <span class="tlaGNC">           8 :   const filesToWatch: string[] = [];</span></span>
<span id="L216"><span class="lineNum">     216</span> <span class="tlaGNC">           8 : </span></span>
<span id="L217"><span class="lineNum">     217</span> <span class="tlaGNC">           8 :   if (typeAcquisition.include)</span></span>
<span id="L218"><span class="lineNum">     218</span> <span class="tlaGNC">           8 :     addInferredTypings(typeAcquisition.include, &quot;Explicitly included types&quot;);</span></span>
<span id="L219"><span class="lineNum">     219</span> <span class="tlaGNC">           8 :   const exclude = typeAcquisition.exclude || [];</span></span>
<span id="L220"><span class="lineNum">     220</span> <span class="tlaGNC">           8 : </span></span>
<span id="L221"><span class="lineNum">     221</span> <span class="tlaGNC">           8 :   // Directories to search for package.json, bower.json and other typing information</span></span>
<span id="L222"><span class="lineNum">     222</span> <span class="tlaGNC">           8 :   if (!compilerOptions.types) {</span></span>
<span id="L223"><span class="lineNum">     223</span> <span class="tlaGNC">           8 :     const possibleSearchDirs = new Set(fileNames.map(getDirectoryPath));</span></span>
<span id="L224"><span class="lineNum">     224</span> <span class="tlaGNC">           8 :     possibleSearchDirs.add(projectRootPath);</span></span>
<span id="L225"><span class="lineNum">     225</span> <span class="tlaGNC">           8 :     possibleSearchDirs.forEach((searchDir) =&gt; {</span></span>
<span id="L226"><span class="lineNum">     226</span> <span class="tlaGNC">           8 :       getTypingNames(searchDir, &quot;bower.json&quot;, &quot;bower_components&quot;, filesToWatch);</span></span>
<span id="L227"><span class="lineNum">     227</span> <span class="tlaGNC">           8 :       getTypingNames(searchDir, &quot;package.json&quot;, &quot;node_modules&quot;, filesToWatch);</span></span>
<span id="L228"><span class="lineNum">     228</span> <span class="tlaGNC">           8 :     });</span></span>
<span id="L229"><span class="lineNum">     229</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L230"><span class="lineNum">     230</span> <span class="tlaGNC">           8 : </span></span>
<span id="L231"><span class="lineNum">     231</span> <span class="tlaGNC">           8 :   if (!typeAcquisition.disableFilenameBasedTypeAcquisition) {</span></span>
<span id="L232"><span class="lineNum">     232</span> <span class="tlaGNC">           8 :     getTypingNamesFromSourceFileNames(fileNames);</span></span>
<span id="L233"><span class="lineNum">     233</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L234"><span class="lineNum">     234</span> <span class="tlaGNC">           8 :   // add typings for unresolved imports</span></span>
<span id="L235"><span class="lineNum">     235</span> <span class="tlaGNC">           8 :   if (unresolvedImports) {</span></span>
<span id="L236"><span class="lineNum">     236</span> <span class="tlaGNC">           8 :     const module = deduplicate&lt;string&gt;(</span></span>
<span id="L237"><span class="lineNum">     237</span> <span class="tlaGNC">           8 :       unresolvedImports.map(nonRelativeModuleNameForTypingCache),</span></span>
<span id="L238"><span class="lineNum">     238</span> <span class="tlaGNC">           8 :       equateStringsCaseSensitive,</span></span>
<span id="L239"><span class="lineNum">     239</span> <span class="tlaGNC">           8 :       compareStringsCaseSensitive,</span></span>
<span id="L240"><span class="lineNum">     240</span> <span class="tlaGNC">           8 :     );</span></span>
<span id="L241"><span class="lineNum">     241</span> <span class="tlaGNC">           8 :     addInferredTypings(module, &quot;Inferred typings from unresolved imports&quot;);</span></span>
<span id="L242"><span class="lineNum">     242</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L243"><span class="lineNum">     243</span> <span class="tlaGNC">           8 :   // Remove typings that the user has added to the exclude list</span></span>
<span id="L244"><span class="lineNum">     244</span> <span class="tlaGNC">           8 :   for (const excludeTypingName of exclude) {</span></span>
<span id="L245"><span class="lineNum">     245</span> <span class="tlaGNC">           8 :     const didDelete = inferredTypings.delete(excludeTypingName);</span></span>
<span id="L246"><span class="lineNum">     246</span> <span class="tlaGNC">           8 :     if (didDelete &amp;&amp; log)</span></span>
<span id="L247"><span class="lineNum">     247</span> <span class="tlaGNC">           8 :       log(</span></span>
<span id="L248"><span class="lineNum">     248</span> <span class="tlaGNC">           8 :         `Typing for ${excludeTypingName} is in exclude list, will be ignored.`,</span></span>
<span id="L249"><span class="lineNum">     249</span> <span class="tlaGNC">           8 :       );</span></span>
<span id="L250"><span class="lineNum">     250</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L251"><span class="lineNum">     251</span> <span class="tlaGNC">           8 : </span></span>
<span id="L252"><span class="lineNum">     252</span> <span class="tlaGNC">           8 :   // Add the cached typing locations for inferred typings that are already installed</span></span>
<span id="L253"><span class="lineNum">     253</span> <span class="tlaGNC">           8 :   packageNameToTypingLocation.forEach((typing, name) =&gt; {</span></span>
<span id="L254"><span class="lineNum">     254</span> <span class="tlaGNC">           8 :     const registryEntry = typesRegistry.get(name);</span></span>
<span id="L255"><span class="lineNum">     255</span> <span class="tlaGNC">           8 :     if (</span></span>
<span id="L256"><span class="lineNum">     256</span> <span class="tlaGNC">           8 :       inferredTypings.get(name) === false &amp;&amp;</span></span>
<span id="L257"><span class="lineNum">     257</span> <span class="tlaGNC">           8 :       registryEntry !== undefined &amp;&amp;</span></span>
<span id="L258"><span class="lineNum">     258</span> <span class="tlaGNC">           8 :       isTypingUpToDate(typing, registryEntry)</span></span>
<span id="L259"><span class="lineNum">     259</span> <span class="tlaGNC">           8 :     ) {</span></span>
<span id="L260"><span class="lineNum">     260</span> <span class="tlaGNC">           8 :       inferredTypings.set(name, typing.typingLocation);</span></span>
<span id="L261"><span class="lineNum">     261</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L262"><span class="lineNum">     262</span> <span class="tlaGNC">           8 :   });</span></span>
<span id="L263"><span class="lineNum">     263</span> <span class="tlaGNC">           8 : </span></span>
<span id="L264"><span class="lineNum">     264</span> <span class="tlaGNC">           8 :   const newTypingNames: string[] = [];</span></span>
<span id="L265"><span class="lineNum">     265</span> <span class="tlaGNC">           8 :   const cachedTypingPaths: string[] = [];</span></span>
<span id="L266"><span class="lineNum">     266</span> <span class="tlaGNC">           8 :   inferredTypings.forEach((inferred, typing) =&gt; {</span></span>
<span id="L267"><span class="lineNum">     267</span> <span class="tlaGNC">           8 :     if (inferred) {</span></span>
<span id="L268"><span class="lineNum">     268</span> <span class="tlaGNC">           8 :       cachedTypingPaths.push(inferred);</span></span>
<span id="L269"><span class="lineNum">     269</span> <span class="tlaGNC">           8 :     } else {</span></span>
<span id="L270"><span class="lineNum">     270</span> <span class="tlaGNC">           8 :       newTypingNames.push(typing);</span></span>
<span id="L271"><span class="lineNum">     271</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L272"><span class="lineNum">     272</span> <span class="tlaGNC">           8 :   });</span></span>
<span id="L273"><span class="lineNum">     273</span> <span class="tlaGNC">           8 :   const result = { cachedTypingPaths, newTypingNames, filesToWatch };</span></span>
<span id="L274"><span class="lineNum">     274</span> <span class="tlaGNC">           8 :   if (log) log(`Finished typings discovery:${stringifyIndented(result)}`);</span></span>
<span id="L275"><span class="lineNum">     275</span> <span class="tlaGNC">           8 :   return result;</span></span>
<span id="L276"><span class="lineNum">     276</span> <span class="tlaGNC">           8 : </span></span>
<span id="L277"><span class="lineNum">     277</span> <span class="tlaGNC">           8 :   function addInferredTyping(typingName: string) {</span></span>
<span id="L278"><span class="lineNum">     278</span> <span class="tlaGNC">           8 :     if (!inferredTypings.has(typingName)) {</span></span>
<span id="L279"><span class="lineNum">     279</span> <span class="tlaGNC">           8 :       inferredTypings.set(typingName, false);</span></span>
<span id="L280"><span class="lineNum">     280</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L281"><span class="lineNum">     281</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L282"><span class="lineNum">     282</span> <span class="tlaGNC">           8 :   function addInferredTypings(typingNames: readonly string[], message: string) {</span></span>
<span id="L283"><span class="lineNum">     283</span> <span class="tlaGNC">           8 :     if (log) log(`${message}: ${JSON.stringify(typingNames)}`);</span></span>
<span id="L284"><span class="lineNum">     284</span> <span class="tlaGNC">           8 :     forEach(typingNames, addInferredTyping);</span></span>
<span id="L285"><span class="lineNum">     285</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L286"><span class="lineNum">     286</span> <span class="tlaGNC">           8 : </span></span>
<span id="L287"><span class="lineNum">     287</span> <span class="tlaGNC">           8 :   /**</span></span>
<span id="L288"><span class="lineNum">     288</span> <span class="tlaGNC">           8 :    * Adds inferred typings from manifest/module pairs (think package.json + node_modules)</span></span>
<span id="L289"><span class="lineNum">     289</span> <span class="tlaGNC">           8 :    *</span></span>
<span id="L290"><span class="lineNum">     290</span> <span class="tlaGNC">           8 :    * @param projectRootPath is the path to the directory where to look for package.json, bower.json and other typing information</span></span>
<span id="L291"><span class="lineNum">     291</span> <span class="tlaGNC">           8 :    * @param manifestName is the name of the manifest (package.json or bower.json)</span></span>
<span id="L292"><span class="lineNum">     292</span> <span class="tlaGNC">           8 :    * @param modulesDirName is the directory name for modules (node_modules or bower_components). Should be lowercase!</span></span>
<span id="L293"><span class="lineNum">     293</span> <span class="tlaGNC">           8 :    * @param filesToWatch are the files to watch for changes. We will push things into this array.</span></span>
<span id="L294"><span class="lineNum">     294</span> <span class="tlaGNC">           8 :    */</span></span>
<span id="L295"><span class="lineNum">     295</span> <span class="tlaGNC">           8 :   function getTypingNames(</span></span>
<span id="L296"><span class="lineNum">     296</span> <span class="tlaGNC">           8 :     projectRootPath: string,</span></span>
<span id="L297"><span class="lineNum">     297</span> <span class="tlaGNC">           8 :     manifestName: string,</span></span>
<span id="L298"><span class="lineNum">     298</span> <span class="tlaGNC">           8 :     modulesDirName: string,</span></span>
<span id="L299"><span class="lineNum">     299</span> <span class="tlaGNC">           8 :     filesToWatch: string[],</span></span>
<span id="L300"><span class="lineNum">     300</span> <span class="tlaGNC">           8 :   ): void {</span></span>
<span id="L301"><span class="lineNum">     301</span> <span class="tlaGNC">           8 :     // First, we check the manifests themselves. They're not</span></span>
<span id="L302"><span class="lineNum">     302</span> <span class="tlaGNC">           8 :     // _required_, but they allow us to do some filtering when dealing</span></span>
<span id="L303"><span class="lineNum">     303</span> <span class="tlaGNC">           8 :     // with big flat dep directories.</span></span>
<span id="L304"><span class="lineNum">     304</span> <span class="tlaGNC">           8 :     const manifestPath = combinePaths(projectRootPath, manifestName);</span></span>
<span id="L305"><span class="lineNum">     305</span> <span class="tlaGNC">           8 :     let manifest;</span></span>
<span id="L306"><span class="lineNum">     306</span> <span class="tlaGNC">           8 :     let manifestTypingNames;</span></span>
<span id="L307"><span class="lineNum">     307</span> <span class="tlaGNC">           8 :     if (host.fileExists(manifestPath)) {</span></span>
<span id="L308"><span class="lineNum">     308</span> <span class="tlaGNC">           8 :       filesToWatch.push(manifestPath);</span></span>
<span id="L309"><span class="lineNum">     309</span> <span class="tlaGNC">           8 :       manifest = readConfigFile(manifestPath, (path) =&gt;</span></span>
<span id="L310"><span class="lineNum">     310</span> <span class="tlaGNC">           8 :         host.readFile(path),</span></span>
<span id="L311"><span class="lineNum">     311</span> <span class="tlaGNC">           8 :       ).config;</span></span>
<span id="L312"><span class="lineNum">     312</span> <span class="tlaGNC">           8 :       manifestTypingNames = flatMap(</span></span>
<span id="L313"><span class="lineNum">     313</span> <span class="tlaGNC">           8 :         [</span></span>
<span id="L314"><span class="lineNum">     314</span> <span class="tlaGNC">           8 :           manifest.dependencies,</span></span>
<span id="L315"><span class="lineNum">     315</span> <span class="tlaGNC">           8 :           manifest.devDependencies,</span></span>
<span id="L316"><span class="lineNum">     316</span> <span class="tlaGNC">           8 :           manifest.optionalDependencies,</span></span>
<span id="L317"><span class="lineNum">     317</span> <span class="tlaGNC">           8 :           manifest.peerDependencies,</span></span>
<span id="L318"><span class="lineNum">     318</span> <span class="tlaGNC">           8 :         ],</span></span>
<span id="L319"><span class="lineNum">     319</span> <span class="tlaGNC">           8 :         getOwnKeys,</span></span>
<span id="L320"><span class="lineNum">     320</span> <span class="tlaGNC">           8 :       );</span></span>
<span id="L321"><span class="lineNum">     321</span> <span class="tlaGNC">           8 :       addInferredTypings(</span></span>
<span id="L322"><span class="lineNum">     322</span> <span class="tlaGNC">           8 :         manifestTypingNames,</span></span>
<span id="L323"><span class="lineNum">     323</span> <span class="tlaGNC">           8 :         `Typing names in '${manifestPath}' dependencies`,</span></span>
<span id="L324"><span class="lineNum">     324</span> <span class="tlaGNC">           8 :       );</span></span>
<span id="L325"><span class="lineNum">     325</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L326"><span class="lineNum">     326</span> <span class="tlaGNC">           8 : </span></span>
<span id="L327"><span class="lineNum">     327</span> <span class="tlaGNC">           8 :     // Now we scan the directories for typing information in</span></span>
<span id="L328"><span class="lineNum">     328</span> <span class="tlaGNC">           8 :     // already-installed dependencies (if present). Note that this</span></span>
<span id="L329"><span class="lineNum">     329</span> <span class="tlaGNC">           8 :     // step happens regardless of whether a manifest was present,</span></span>
<span id="L330"><span class="lineNum">     330</span> <span class="tlaGNC">           8 :     // which is certainly a valid configuration, if an unusual one.</span></span>
<span id="L331"><span class="lineNum">     331</span> <span class="tlaGNC">           8 :     const packagesFolderPath = combinePaths(projectRootPath, modulesDirName);</span></span>
<span id="L332"><span class="lineNum">     332</span> <span class="tlaGNC">           8 :     filesToWatch.push(packagesFolderPath);</span></span>
<span id="L333"><span class="lineNum">     333</span> <span class="tlaGNC">           8 :     if (!host.directoryExists(packagesFolderPath)) {</span></span>
<span id="L334"><span class="lineNum">     334</span> <span class="tlaGNC">           8 :       return;</span></span>
<span id="L335"><span class="lineNum">     335</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L336"><span class="lineNum">     336</span> <span class="tlaGNC">           8 : </span></span>
<span id="L337"><span class="lineNum">     337</span> <span class="tlaGNC">           8 :     // There's two cases we have to take into account here:</span></span>
<span id="L338"><span class="lineNum">     338</span> <span class="tlaGNC">           8 :     // 1. If manifest is undefined, then we're not using a manifest.</span></span>
<span id="L339"><span class="lineNum">     339</span> <span class="tlaGNC">           8 :     //    That means that we should scan _all_ dependencies at the top</span></span>
<span id="L340"><span class="lineNum">     340</span> <span class="tlaGNC">           8 :     //    level of the modulesDir.</span></span>
<span id="L341"><span class="lineNum">     341</span> <span class="tlaGNC">           8 :     // 2. If manifest is defined, then we can do some special</span></span>
<span id="L342"><span class="lineNum">     342</span> <span class="tlaGNC">           8 :     //    filtering to reduce the amount of scanning we need to do.</span></span>
<span id="L343"><span class="lineNum">     343</span> <span class="tlaGNC">           8 :     //</span></span>
<span id="L344"><span class="lineNum">     344</span> <span class="tlaGNC">           8 :     // Previous versions of this algorithm checked for a `_requiredBy`</span></span>
<span id="L345"><span class="lineNum">     345</span> <span class="tlaGNC">           8 :     // field in the package.json, but that field is only present in</span></span>
<span id="L346"><span class="lineNum">     346</span> <span class="tlaGNC">           8 :     // `npm@&gt;=3 &lt;7`.</span></span>
<span id="L347"><span class="lineNum">     347</span> <span class="tlaGNC">           8 : </span></span>
<span id="L348"><span class="lineNum">     348</span> <span class="tlaGNC">           8 :     // Package names that do **not** provide their own typings, so</span></span>
<span id="L349"><span class="lineNum">     349</span> <span class="tlaGNC">           8 :     // we'll look them up.</span></span>
<span id="L350"><span class="lineNum">     350</span> <span class="tlaGNC">           8 :     const packageNames: string[] = [];</span></span>
<span id="L351"><span class="lineNum">     351</span> <span class="tlaGNC">           8 : </span></span>
<span id="L352"><span class="lineNum">     352</span> <span class="tlaGNC">           8 :     const dependencyManifestNames = manifestTypingNames</span></span>
<span id="L353"><span class="lineNum">     353</span> <span class="tlaGNC">           8 :       ? // This is #1 described above.</span></span>
<span id="L354"><span class="lineNum">     354</span> <span class="tlaGNC">           8 :         manifestTypingNames.map((typingName) =&gt;</span></span>
<span id="L355"><span class="lineNum">     355</span> <span class="tlaGNC">           8 :           combinePaths(packagesFolderPath, typingName, manifestName),</span></span>
<span id="L356"><span class="lineNum">     356</span> <span class="tlaGNC">           8 :         )</span></span>
<span id="L357"><span class="lineNum">     357</span> <span class="tlaGNC">           8 :       : // And #2. Depth = 3 because scoped packages look like `node_modules/@foo/bar/package.json`</span></span>
<span id="L358"><span class="lineNum">     358</span> <span class="tlaGNC">           8 :         host</span></span>
<span id="L359"><span class="lineNum">     359</span> <span class="tlaGNC">           8 :           .readDirectory(</span></span>
<span id="L360"><span class="lineNum">     360</span> <span class="tlaGNC">           8 :             packagesFolderPath,</span></span>
<span id="L361"><span class="lineNum">     361</span> <span class="tlaGNC">           8 :             [Extension.Json],</span></span>
<span id="L362"><span class="lineNum">     362</span> <span class="tlaGNC">           8 :             /*excludes*/ undefined,</span></span>
<span id="L363"><span class="lineNum">     363</span> <span class="tlaGNC">           8 :             /*includes*/ undefined,</span></span>
<span id="L364"><span class="lineNum">     364</span> <span class="tlaGNC">           8 :             /*depth*/ 3,</span></span>
<span id="L365"><span class="lineNum">     365</span> <span class="tlaGNC">           8 :           )</span></span>
<span id="L366"><span class="lineNum">     366</span> <span class="tlaGNC">           8 :           .filter((manifestPath) =&gt; {</span></span>
<span id="L367"><span class="lineNum">     367</span> <span class="tlaGNC">           8 :             if (getBaseFileName(manifestPath) !== manifestName) {</span></span>
<span id="L368"><span class="lineNum">     368</span> <span class="tlaGNC">           8 :               return false;</span></span>
<span id="L369"><span class="lineNum">     369</span> <span class="tlaGNC">           8 :             }</span></span>
<span id="L370"><span class="lineNum">     370</span> <span class="tlaGNC">           8 :             // It's ok to treat</span></span>
<span id="L371"><span class="lineNum">     371</span> <span class="tlaGNC">           8 :             // `node_modules/@foo/bar/package.json` as a manifest,</span></span>
<span id="L372"><span class="lineNum">     372</span> <span class="tlaGNC">           8 :             // but not `node_modules/jquery/nested/package.json`.</span></span>
<span id="L373"><span class="lineNum">     373</span> <span class="tlaGNC">           8 :             // We only assume depth 3 is ok for formally scoped</span></span>
<span id="L374"><span class="lineNum">     374</span> <span class="tlaGNC">           8 :             // packages. So that needs this dance here.</span></span>
<span id="L375"><span class="lineNum">     375</span> <span class="tlaGNC">           8 :             const pathComponents = getPathComponents(</span></span>
<span id="L376"><span class="lineNum">     376</span> <span class="tlaGNC">           8 :               normalizePath(manifestPath),</span></span>
<span id="L377"><span class="lineNum">     377</span> <span class="tlaGNC">           8 :             );</span></span>
<span id="L378"><span class="lineNum">     378</span> <span class="tlaGNC">           8 :             const isScoped =</span></span>
<span id="L379"><span class="lineNum">     379</span> <span class="tlaGNC">           8 :               pathComponents[pathComponents.length - 3][0] === &quot;@&quot;;</span></span>
<span id="L380"><span class="lineNum">     380</span> <span class="tlaGNC">           8 :             return (</span></span>
<span id="L381"><span class="lineNum">     381</span> <span class="tlaGNC">           8 :               (isScoped &amp;&amp;</span></span>
<span id="L382"><span class="lineNum">     382</span> <span class="tlaGNC">           8 :                 toFileNameLowerCase(</span></span>
<span id="L383"><span class="lineNum">     383</span> <span class="tlaGNC">           8 :                   pathComponents[pathComponents.length - 4],</span></span>
<span id="L384"><span class="lineNum">     384</span> <span class="tlaGNC">           8 :                 ) === modulesDirName) || // `node_modules/@foo/bar`</span></span>
<span id="L385"><span class="lineNum">     385</span> <span class="tlaGNC">           8 :               (!isScoped &amp;&amp;</span></span>
<span id="L386"><span class="lineNum">     386</span> <span class="tlaGNC">           8 :                 toFileNameLowerCase(</span></span>
<span id="L387"><span class="lineNum">     387</span> <span class="tlaGNC">           8 :                   pathComponents[pathComponents.length - 3],</span></span>
<span id="L388"><span class="lineNum">     388</span> <span class="tlaGNC">           8 :                 ) === modulesDirName)</span></span>
<span id="L389"><span class="lineNum">     389</span> <span class="tlaGNC">           8 :             ); // `node_modules/foo`</span></span>
<span id="L390"><span class="lineNum">     390</span> <span class="tlaGNC">           8 :           });</span></span>
<span id="L391"><span class="lineNum">     391</span> <span class="tlaGNC">           8 : </span></span>
<span id="L392"><span class="lineNum">     392</span> <span class="tlaGNC">           8 :     if (log)</span></span>
<span id="L393"><span class="lineNum">     393</span> <span class="tlaGNC">           8 :       log(</span></span>
<span id="L394"><span class="lineNum">     394</span> <span class="tlaGNC">           8 :         `Searching for typing names in ${packagesFolderPath}; all files: ${JSON.stringify(dependencyManifestNames)}`,</span></span>
<span id="L395"><span class="lineNum">     395</span> <span class="tlaGNC">           8 :       );</span></span>
<span id="L396"><span class="lineNum">     396</span> <span class="tlaGNC">           8 : </span></span>
<span id="L397"><span class="lineNum">     397</span> <span class="tlaGNC">           8 :     // Once we have the names of things to look up, we iterate over</span></span>
<span id="L398"><span class="lineNum">     398</span> <span class="tlaGNC">           8 :     // and either collect their included typings, or add them to the</span></span>
<span id="L399"><span class="lineNum">     399</span> <span class="tlaGNC">           8 :     // list of typings we need to look up separately.</span></span>
<span id="L400"><span class="lineNum">     400</span> <span class="tlaGNC">           8 :     for (const manifestPath of dependencyManifestNames) {</span></span>
<span id="L401"><span class="lineNum">     401</span> <span class="tlaGNC">           8 :       const normalizedFileName = normalizePath(manifestPath);</span></span>
<span id="L402"><span class="lineNum">     402</span> <span class="tlaGNC">           8 :       const result = readConfigFile(normalizedFileName, (path: string) =&gt;</span></span>
<span id="L403"><span class="lineNum">     403</span> <span class="tlaGNC">           8 :         host.readFile(path),</span></span>
<span id="L404"><span class="lineNum">     404</span> <span class="tlaGNC">           8 :       );</span></span>
<span id="L405"><span class="lineNum">     405</span> <span class="tlaGNC">           8 :       const manifest: PackageJson = result.config;</span></span>
<span id="L406"><span class="lineNum">     406</span> <span class="tlaGNC">           8 : </span></span>
<span id="L407"><span class="lineNum">     407</span> <span class="tlaGNC">           8 :       // If the package has its own d.ts typings, those will take precedence. Otherwise the package name will be used</span></span>
<span id="L408"><span class="lineNum">     408</span> <span class="tlaGNC">           8 :       // to download d.ts files from DefinitelyTyped</span></span>
<span id="L409"><span class="lineNum">     409</span> <span class="tlaGNC">           8 :       if (!manifest.name) {</span></span>
<span id="L410"><span class="lineNum">     410</span> <span class="tlaGNC">           8 :         continue;</span></span>
<span id="L411"><span class="lineNum">     411</span> <span class="tlaGNC">           8 :       }</span></span>
<span id="L412"><span class="lineNum">     412</span> <span class="tlaGNC">           8 :       const ownTypes = manifest.types || manifest.typings;</span></span>
<span id="L413"><span class="lineNum">     413</span> <span class="tlaGNC">           8 :       if (ownTypes) {</span></span>
<span id="L414"><span class="lineNum">     414</span> <span class="tlaGNC">           8 :         const absolutePath = getNormalizedAbsolutePath(</span></span>
<span id="L415"><span class="lineNum">     415</span> <span class="tlaGNC">           8 :           ownTypes,</span></span>
<span id="L416"><span class="lineNum">     416</span> <span class="tlaGNC">           8 :           getDirectoryPath(normalizedFileName),</span></span>
<span id="L417"><span class="lineNum">     417</span> <span class="tlaGNC">           8 :         );</span></span>
<span id="L418"><span class="lineNum">     418</span> <span class="tlaGNC">           8 :         if (host.fileExists(absolutePath)) {</span></span>
<span id="L419"><span class="lineNum">     419</span> <span class="tlaGNC">           8 :           if (log)</span></span>
<span id="L420"><span class="lineNum">     420</span> <span class="tlaGNC">           8 :             log(`    Package '${manifest.name}' provides its own types.`);</span></span>
<span id="L421"><span class="lineNum">     421</span> <span class="tlaGNC">           8 :           inferredTypings.set(manifest.name, absolutePath);</span></span>
<span id="L422"><span class="lineNum">     422</span> <span class="tlaGNC">           8 :         } else {</span></span>
<span id="L423"><span class="lineNum">     423</span> <span class="tlaGNC">           8 :           if (log)</span></span>
<span id="L424"><span class="lineNum">     424</span> <span class="tlaGNC">           8 :             log(</span></span>
<span id="L425"><span class="lineNum">     425</span> <span class="tlaGNC">           8 :               `    Package '${manifest.name}' provides its own types but they are missing.`,</span></span>
<span id="L426"><span class="lineNum">     426</span> <span class="tlaGNC">           8 :             );</span></span>
<span id="L427"><span class="lineNum">     427</span> <span class="tlaGNC">           8 :         }</span></span>
<span id="L428"><span class="lineNum">     428</span> <span class="tlaGNC">           8 :       } else {</span></span>
<span id="L429"><span class="lineNum">     429</span> <span class="tlaGNC">           8 :         packageNames.push(manifest.name);</span></span>
<span id="L430"><span class="lineNum">     430</span> <span class="tlaGNC">           8 :       }</span></span>
<span id="L431"><span class="lineNum">     431</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L432"><span class="lineNum">     432</span> <span class="tlaGNC">           8 : </span></span>
<span id="L433"><span class="lineNum">     433</span> <span class="tlaGNC">           8 :     addInferredTypings(packageNames, &quot;    Found package names&quot;);</span></span>
<span id="L434"><span class="lineNum">     434</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L435"><span class="lineNum">     435</span> <span class="tlaGNC">           8 : </span></span>
<span id="L436"><span class="lineNum">     436</span> <span class="tlaGNC">           8 :   /**</span></span>
<span id="L437"><span class="lineNum">     437</span> <span class="tlaGNC">           8 :    * Infer typing names from given file names. For example, the file name &quot;jquery-min.2.3.4.js&quot;</span></span>
<span id="L438"><span class="lineNum">     438</span> <span class="tlaGNC">           8 :    * should be inferred to the 'jquery' typing name; and &quot;angular-route.1.2.3.js&quot; should be inferred</span></span>
<span id="L439"><span class="lineNum">     439</span> <span class="tlaGNC">           8 :    * to the 'angular-route' typing name.</span></span>
<span id="L440"><span class="lineNum">     440</span> <span class="tlaGNC">           8 :    * @param fileNames are the names for source files in the project</span></span>
<span id="L441"><span class="lineNum">     441</span> <span class="tlaGNC">           8 :    */</span></span>
<span id="L442"><span class="lineNum">     442</span> <span class="tlaGNC">           8 :   function getTypingNamesFromSourceFileNames(fileNames: string[]) {</span></span>
<span id="L443"><span class="lineNum">     443</span> <span class="tlaGNC">           8 :     const fromFileNames = mapDefined(fileNames, (j) =&gt; {</span></span>
<span id="L444"><span class="lineNum">     444</span> <span class="tlaGNC">           8 :       if (!hasJSFileExtension(j)) return undefined;</span></span>
<span id="L445"><span class="lineNum">     445</span> <span class="tlaGNC">           8 : </span></span>
<span id="L446"><span class="lineNum">     446</span> <span class="tlaGNC">           8 :       const inferredTypingName = removeFileExtension(</span></span>
<span id="L447"><span class="lineNum">     447</span> <span class="tlaGNC">           8 :         toFileNameLowerCase(getBaseFileName(j)),</span></span>
<span id="L448"><span class="lineNum">     448</span> <span class="tlaGNC">           8 :       );</span></span>
<span id="L449"><span class="lineNum">     449</span> <span class="tlaGNC">           8 :       const cleanedTypingName = removeMinAndVersionNumbers(inferredTypingName);</span></span>
<span id="L450"><span class="lineNum">     450</span> <span class="tlaGNC">           8 :       return safeList.get(cleanedTypingName);</span></span>
<span id="L451"><span class="lineNum">     451</span> <span class="tlaGNC">           8 :     });</span></span>
<span id="L452"><span class="lineNum">     452</span> <span class="tlaGNC">           8 :     if (fromFileNames.length) {</span></span>
<span id="L453"><span class="lineNum">     453</span> <span class="tlaGNC">           8 :       addInferredTypings(fromFileNames, &quot;Inferred typings from file names&quot;);</span></span>
<span id="L454"><span class="lineNum">     454</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L455"><span class="lineNum">     455</span> <span class="tlaGNC">           8 : </span></span>
<span id="L456"><span class="lineNum">     456</span> <span class="tlaGNC">           8 :     const hasJsxFile = some(fileNames, (f) =&gt;</span></span>
<span id="L457"><span class="lineNum">     457</span> <span class="tlaGNC">           8 :       fileExtensionIs(f, Extension.Jsx),</span></span>
<span id="L458"><span class="lineNum">     458</span> <span class="tlaGNC">           8 :     );</span></span>
<span id="L459"><span class="lineNum">     459</span> <span class="tlaGNC">           8 :     if (hasJsxFile) {</span></span>
<span id="L460"><span class="lineNum">     460</span> <span class="tlaGNC">           8 :       if (log)</span></span>
<span id="L461"><span class="lineNum">     461</span> <span class="tlaGNC">           8 :         log(`Inferred 'react' typings due to presence of '.jsx' extension`);</span></span>
<span id="L462"><span class="lineNum">     462</span> <span class="tlaGNC">           8 :       addInferredTyping(&quot;react&quot;);</span></span>
<span id="L463"><span class="lineNum">     463</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L464"><span class="lineNum">     464</span> <span class="tlaGNC">           8 :   }</span></span>
<span id="L465"><span class="lineNum">     465</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L466"><span class="lineNum">     466</span> <span class="tlaGNC">           8 : </span></span>
<span id="L467"><span class="lineNum">     467</span> <span class="tlaGNC">           8 : /** @internal */</span></span>
<span id="L468"><span class="lineNum">     468</span> <span class="tlaGNC">           8 : export const enum NameValidationResult {</span></span>
<span id="L469"><span class="lineNum">     469</span> <span class="tlaGNC">           8 :   Ok,</span></span>
<span id="L470"><span class="lineNum">     470</span> <span class="tlaGNC">           8 :   EmptyName,</span></span>
<span id="L471"><span class="lineNum">     471</span> <span class="tlaGNC">           8 :   NameTooLong,</span></span>
<span id="L472"><span class="lineNum">     472</span> <span class="tlaGNC">           8 :   NameStartsWithDot,</span></span>
<span id="L473"><span class="lineNum">     473</span> <span class="tlaGNC">           8 :   NameStartsWithUnderscore,</span></span>
<span id="L474"><span class="lineNum">     474</span> <span class="tlaGNC">           8 :   NameContainsNonURISafeCharacters,</span></span>
<span id="L475"><span class="lineNum">     475</span> <span class="tlaGNC">           8 : }</span></span>
<span id="L476"><span class="lineNum">     476</span> <span class="tlaGNC">           8 : </span></span>
<span id="L477"><span class="lineNum">     477</span> <span class="tlaGNC">           8 : const maxPackageNameLength = 214;</span></span>
<span id="L478"><span class="lineNum">     478</span> <span class="tlaGNC">           1 : </span></span>
<span id="L479"><span class="lineNum">     479</span> <span class="tlaGNC">           1 : /** @internal */</span></span>
<span id="L480"><span class="lineNum">     480</span> <span class="tlaGNC">           1 : export interface ScopedPackageNameValidationResult {</span></span>
<span id="L481"><span class="lineNum">     481</span> <span class="tlaGNC">           1 :   name: string;</span></span>
<span id="L482"><span class="lineNum">     482</span> <span class="tlaGNC">           1 :   isScopeName: boolean;</span></span>
<span id="L483"><span class="lineNum">     483</span> <span class="tlaGNC">           1 :   result: NameValidationResult;</span></span>
<span id="L484"><span class="lineNum">     484</span> <span class="tlaGNC">           1 : }</span></span>
<span id="L485"><span class="lineNum">     485</span> <span class="tlaGNC">           1 : /** @internal */</span></span>
<span id="L486"><span class="lineNum">     486</span> <span class="tlaGNC">           1 : export type PackageNameValidationResult =</span></span>
<span id="L487"><span class="lineNum">     487</span> <span class="tlaGNC">           1 :   | NameValidationResult</span></span>
<span id="L488"><span class="lineNum">     488</span> <span class="tlaGNC">           1 :   | ScopedPackageNameValidationResult;</span></span>
<span id="L489"><span class="lineNum">     489</span> <span class="tlaGNC">           1 : </span></span>
<span id="L490"><span class="lineNum">     490</span> <span class="tlaGNC">           1 : /**</span></span>
<span id="L491"><span class="lineNum">     491</span> <span class="tlaGNC">           1 :  * Validates package name using rules defined at https://docs.npmjs.com/files/package.json</span></span>
<span id="L492"><span class="lineNum">     492</span> <span class="tlaGNC">           1 :  *</span></span>
<span id="L493"><span class="lineNum">     493</span> <span class="tlaGNC">           1 :  * @internal</span></span>
<span id="L494"><span class="lineNum">     494</span> <span class="tlaGNC">           1 :  */</span></span>
<span id="L495"><span class="lineNum">     495</span> <span class="tlaGNC">           1 : export function validatePackageName(</span></span>
<span id="L496"><span class="lineNum">     496</span> <span class="tlaGNC">         127 :   packageName: string,</span></span>
<span id="L497"><span class="lineNum">     497</span> <span class="tlaGNC">         127 : ): PackageNameValidationResult {</span></span>
<span id="L498"><span class="lineNum">     498</span> <span class="tlaGNC">         127 :   return validatePackageNameWorker(packageName, /*supportScopedPackage*/ true);</span></span>
<span id="L499"><span class="lineNum">     499</span> <span class="tlaGNC">         127 : }</span></span>
<span id="L500"><span class="lineNum">     500</span> <span class="tlaGNC">           1 : </span></span>
<span id="L501"><span class="lineNum">     501</span> <span class="tlaGNC">           1 : function validatePackageNameWorker(</span></span>
<span id="L502"><span class="lineNum">     502</span> <span class="tlaGNC">           1 :   packageName: string,</span></span>
<span id="L503"><span class="lineNum">     503</span> <span class="tlaGNC">           1 :   supportScopedPackage: false,</span></span>
<span id="L504"><span class="lineNum">     504</span> <span class="tlaGNC">           1 : ): NameValidationResult;</span></span>
<span id="L505"><span class="lineNum">     505</span> <span class="tlaGNC">           1 : function validatePackageNameWorker(</span></span>
<span id="L506"><span class="lineNum">     506</span> <span class="tlaGNC">           1 :   packageName: string,</span></span>
<span id="L507"><span class="lineNum">     507</span> <span class="tlaGNC">           1 :   supportScopedPackage: true,</span></span>
<span id="L508"><span class="lineNum">     508</span> <span class="tlaGNC">           1 : ): PackageNameValidationResult;</span></span>
<span id="L509"><span class="lineNum">     509</span> <span class="tlaGNC">         158 : function validatePackageNameWorker(</span></span>
<span id="L510"><span class="lineNum">     510</span> <span class="tlaGNC">         158 :   packageName: string,</span></span>
<span id="L511"><span class="lineNum">     511</span> <span class="tlaGNC">         158 :   supportScopedPackage: boolean,</span></span>
<span id="L512"><span class="lineNum">     512</span> <span class="tlaGNC">         158 : ): PackageNameValidationResult {</span></span>
<span id="L513"><span class="lineNum">     513</span> <span class="tlaGNC">         158 :   if (!packageName) {</span></span>
<span id="L514"><span class="lineNum">     514</span> <span class="tlaUNC tlaBgUNC">           0 :     return NameValidationResult.EmptyName;</span></span>
<span id="L515"><span class="lineNum">     515</span> <span class="tlaUNC">           0 :   }</span></span>
<span id="L516"><span class="lineNum">     516</span> <span class="tlaGNC tlaBgGNC">         158 :   if (packageName.length &gt; maxPackageNameLength) {</span></span>
<span id="L517"><span class="lineNum">     517</span> <span class="tlaGNC">           1 :     return NameValidationResult.NameTooLong;</span></span>
<span id="L518"><span class="lineNum">     518</span> <span class="tlaGNC">           1 :   }</span></span>
<span id="L519"><span class="lineNum">     519</span> <span class="tlaGNC">         158 :   if (packageName.charCodeAt(0) === CharacterCodes.dot) {</span></span>
<span id="L520"><span class="lineNum">     520</span> <span class="tlaGNC">           4 :     return NameValidationResult.NameStartsWithDot;</span></span>
<span id="L521"><span class="lineNum">     521</span> <span class="tlaGNC">           4 :   }</span></span>
<span id="L522"><span class="lineNum">     522</span> <span class="tlaGNC">         158 :   if (packageName.charCodeAt(0) === CharacterCodes._) {</span></span>
<span id="L523"><span class="lineNum">     523</span> <span class="tlaGNC">           4 :     return NameValidationResult.NameStartsWithUnderscore;</span></span>
<span id="L524"><span class="lineNum">     524</span> <span class="tlaGNC">           4 :   }</span></span>
<span id="L525"><span class="lineNum">     525</span> <span class="tlaGNC">         149 :   // check if name is scope package like: starts with @ and has one '/' in the middle</span></span>
<span id="L526"><span class="lineNum">     526</span> <span class="tlaGNC">         149 :   // scoped packages are not currently supported</span></span>
<span id="L527"><span class="lineNum">     527</span> <span class="tlaGNC">         158 :   if (supportScopedPackage) {</span></span>
<span id="L528"><span class="lineNum">     528</span> <span class="tlaGNC">         124 :     const matches = /^@([^/]+)\/([^/]+)$/.exec(packageName);</span></span>
<span id="L529"><span class="lineNum">     529</span> <span class="tlaGNC">         124 :     if (matches) {</span></span>
<span id="L530"><span class="lineNum">     530</span> <span class="tlaGNC">          19 :       const scopeResult = validatePackageNameWorker(</span></span>
<span id="L531"><span class="lineNum">     531</span> <span class="tlaGNC">          19 :         matches[1],</span></span>
<span id="L532"><span class="lineNum">     532</span> <span class="tlaGNC">          19 :         /*supportScopedPackage*/ false,</span></span>
<span id="L533"><span class="lineNum">     533</span> <span class="tlaGNC">          19 :       );</span></span>
<span id="L534"><span class="lineNum">     534</span> <span class="tlaGNC">          19 :       if (scopeResult !== NameValidationResult.Ok) {</span></span>
<span id="L535"><span class="lineNum">     535</span> <span class="tlaGNC">           7 :         return { name: matches[1], isScopeName: true, result: scopeResult };</span></span>
<span id="L536"><span class="lineNum">     536</span> <span class="tlaGNC">           7 :       }</span></span>
<span id="L537"><span class="lineNum">     537</span> <span class="tlaGNC">          12 :       const packageResult = validatePackageNameWorker(</span></span>
<span id="L538"><span class="lineNum">     538</span> <span class="tlaGNC">          12 :         matches[2],</span></span>
<span id="L539"><span class="lineNum">     539</span> <span class="tlaGNC">          12 :         /*supportScopedPackage*/ false,</span></span>
<span id="L540"><span class="lineNum">     540</span> <span class="tlaGNC">          12 :       );</span></span>
<span id="L541"><span class="lineNum">     541</span> <span class="tlaGNC">          19 :       if (packageResult !== NameValidationResult.Ok) {</span></span>
<span id="L542"><span class="lineNum">     542</span> <span class="tlaGNC">           4 :         return { name: matches[2], isScopeName: false, result: packageResult };</span></span>
<span id="L543"><span class="lineNum">     543</span> <span class="tlaGNC">           4 :       }</span></span>
<span id="L544"><span class="lineNum">     544</span> <span class="tlaGNC">           8 :       return NameValidationResult.Ok;</span></span>
<span id="L545"><span class="lineNum">     545</span> <span class="tlaGNC">           8 :     }</span></span>
<span id="L546"><span class="lineNum">     546</span> <span class="tlaGNC">         124 :   }</span></span>
<span id="L547"><span class="lineNum">     547</span> <span class="tlaGNC">         158 :   if (encodeURIComponent(packageName) !== packageName) {</span></span>
<span id="L548"><span class="lineNum">     548</span> <span class="tlaGNC">          11 :     return NameValidationResult.NameContainsNonURISafeCharacters;</span></span>
<span id="L549"><span class="lineNum">     549</span> <span class="tlaGNC">          11 :   }</span></span>
<span id="L550"><span class="lineNum">     550</span> <span class="tlaGNC">         119 :   return NameValidationResult.Ok;</span></span>
<span id="L551"><span class="lineNum">     551</span> <span class="tlaGNC">         119 : }</span></span>
<span id="L552"><span class="lineNum">     552</span> <span class="tlaGNC">           1 : </span></span>
<span id="L553"><span class="lineNum">     553</span> <span class="tlaGNC">           1 : /** @internal */</span></span>
<span id="L554"><span class="lineNum">     554</span> <span class="tlaGNC">           1 : export function renderPackageNameValidationFailure(</span></span>
<span id="L555"><span class="lineNum">     555</span> <span class="tlaGNC">           3 :   result: PackageNameValidationResult,</span></span>
<span id="L556"><span class="lineNum">     556</span> <span class="tlaGNC">           3 :   typing: string,</span></span>
<span id="L557"><span class="lineNum">     557</span> <span class="tlaGNC">           3 : ): string {</span></span>
<span id="L558"><span class="lineNum">     558</span> <span class="tlaGNC">           3 :   return typeof result === &quot;object&quot;</span></span>
<span id="L559"><span class="lineNum">     559</span> <span class="tlaUNC tlaBgUNC">           0 :     ? renderPackageNameValidationFailureWorker(</span></span>
<span id="L560"><span class="lineNum">     560</span> <span class="tlaUNC">           0 :         typing,</span></span>
<span id="L561"><span class="lineNum">     561</span> <span class="tlaUNC">           0 :         result.result,</span></span>
<span id="L562"><span class="lineNum">     562</span> <span class="tlaUNC">           0 :         result.name,</span></span>
<span id="L563"><span class="lineNum">     563</span> <span class="tlaUNC">           0 :         result.isScopeName,</span></span>
<span id="L564"><span class="lineNum">     564</span> <span class="tlaUNC">           0 :       )</span></span>
<span id="L565"><span class="lineNum">     565</span> <span class="tlaGNC tlaBgGNC">           3 :     : renderPackageNameValidationFailureWorker(</span></span>
<span id="L566"><span class="lineNum">     566</span> <span class="tlaGNC">           3 :         typing,</span></span>
<span id="L567"><span class="lineNum">     567</span> <span class="tlaGNC">           3 :         result,</span></span>
<span id="L568"><span class="lineNum">     568</span> <span class="tlaGNC">           3 :         typing,</span></span>
<span id="L569"><span class="lineNum">     569</span> <span class="tlaGNC">           3 :         /*isScopeName*/ false,</span></span>
<span id="L570"><span class="lineNum">     570</span> <span class="tlaGNC">           3 :       );</span></span>
<span id="L571"><span class="lineNum">     571</span> <span class="tlaGNC">           3 : }</span></span>
<span id="L572"><span class="lineNum">     572</span> <span class="tlaGNC">           1 : </span></span>
<span id="L573"><span class="lineNum">     573</span> <span class="tlaGNC">           3 : function renderPackageNameValidationFailureWorker(</span></span>
<span id="L574"><span class="lineNum">     574</span> <span class="tlaGNC">           3 :   typing: string,</span></span>
<span id="L575"><span class="lineNum">     575</span> <span class="tlaGNC">           3 :   result: NameValidationResult,</span></span>
<span id="L576"><span class="lineNum">     576</span> <span class="tlaGNC">           3 :   name: string,</span></span>
<span id="L577"><span class="lineNum">     577</span> <span class="tlaGNC">           3 :   isScopeName: boolean,</span></span>
<span id="L578"><span class="lineNum">     578</span> <span class="tlaGNC">           3 : ): string {</span></span>
<span id="L579"><span class="lineNum">     579</span> <span class="tlaGNC">           3 :   const kind = isScopeName ? &quot;Scope&quot; : &quot;Package&quot;;</span></span>
<span id="L580"><span class="lineNum">     580</span> <span class="tlaGNC">           3 :   switch (result) {</span></span>
<span id="L581"><span class="lineNum">     581</span> <span class="tlaGNC">           3 :     case NameValidationResult.EmptyName:</span></span>
<span id="L582"><span class="lineNum">     582</span> <span class="tlaUNC tlaBgUNC">           0 :       return `'${typing}':: ${kind} name '${name}' cannot be empty`;</span></span>
<span id="L583"><span class="lineNum">     583</span> <span class="tlaGNC tlaBgGNC">           3 :     case NameValidationResult.NameTooLong:</span></span>
<span id="L584"><span class="lineNum">     584</span> <span class="tlaUNC tlaBgUNC">           0 :       return `'${typing}':: ${kind} name '${name}' should be less than ${maxPackageNameLength} characters`;</span></span>
<span id="L585"><span class="lineNum">     585</span> <span class="tlaGNC tlaBgGNC">           3 :     case NameValidationResult.NameStartsWithDot:</span></span>
<span id="L586"><span class="lineNum">     586</span> <span class="tlaUNC tlaBgUNC">           0 :       return `'${typing}':: ${kind} name '${name}' cannot start with '.'`;</span></span>
<span id="L587"><span class="lineNum">     587</span> <span class="tlaGNC tlaBgGNC">           3 :     case NameValidationResult.NameStartsWithUnderscore:</span></span>
<span id="L588"><span class="lineNum">     588</span> <span class="tlaUNC tlaBgUNC">           0 :       return `'${typing}':: ${kind} name '${name}' cannot start with '_'`;</span></span>
<span id="L589"><span class="lineNum">     589</span> <span class="tlaGNC tlaBgGNC">           3 :     case NameValidationResult.NameContainsNonURISafeCharacters:</span></span>
<span id="L590"><span class="lineNum">     590</span> <span class="tlaGNC">           3 :       return `'${typing}':: ${kind} name '${name}' contains non URI safe characters`;</span></span>
<span id="L591"><span class="lineNum">     591</span> <span class="tlaGNC">           3 :     case NameValidationResult.Ok:</span></span>
<span id="L592"><span class="lineNum">     592</span> <span class="tlaUNC tlaBgUNC">           0 :       return Debug.fail(); // Shouldn't have called this.</span></span>
<span id="L593"><span class="lineNum">     593</span> <span class="tlaGNC tlaBgGNC">           3 :     default:</span></span>
<span id="L594"><span class="lineNum">     594</span> <span class="tlaUNC tlaBgUNC">           0 :       Debug.assertNever(result);</span></span>
<span id="L595"><span class="lineNum">     595</span> <span class="tlaGNC tlaBgGNC">           3 :   }</span></span>
<span id="L596"><span class="lineNum">     596</span> <span class="tlaGNC">           3 : }</span></span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.1-1</a></td></tr>
          </table>
          <br>

</body>
</html>
